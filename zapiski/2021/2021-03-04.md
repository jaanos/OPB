---
tags: vaje, opb, join, group, having
hackmd: https://hackmd.io/N-QMh3j1Tv-zLWfI8iB7JQ
---
# Osnove podatkovnih baz - vaje 4.3.2021

---

## `JOIN`, `GROUP BY`, `HAVING`

### `JOIN`

1. Izpiši imena oseb brez traktorjev.

2. Izpiši vse veljavne pare (ime starša, ime otroka).

3. Izpiši starše, ki so svojim otrokom kupili traktor, še preden so ti dopolnili 10 let.

   *Namig:* `cas1+'10 years'::INTERVAL` vrne timestamp, ki opisuje trenutek 10 let po času `cas1`. Timestampe lahko med seboj primerjaš z operatorji `<`, `>`, `<=`, `>=`.

4. Izpiši vse pare (ime osebe, ime starega starša). Za osebe, ki nimajo starih staršev, izpiši par `(ime osebe, NULL)`.

---

### `GROUP BY`, `HAVING`

**Še o funkciji `count()`:**

Funkcija `count()` zna šteti na [tri različne načine](http://www.postgresql.org/docs/current/static/sql-expressions.html#SYNTAX-AGGREGATES):

* `count(*)` prešteje vse vrstice, tudi takšne z vrednostmi `NULL`
* `count(bla)` prešteje vrstice, ki v stolpcu `bla` nimajo `NULL`
* `count(DISTINCT bla)` prešteje število različnih vrednosti v stolpcu `bla`, ki so različne od `NULL`

----

1. Za vsako osebo izpiši, koliko otrok ima. Osebe lahko izpišeš kar z IDjem. Oseb, ki nimajo otrok, ne izpisuj.

2. Za vsako znamko traktorjev izpiši število takih traktorjev v bazi. Pazi na znamko *Edelstahl*. Znamke izpiši z imenom.

3. Za vsako *neprevidno* osebo izpiši, koliko rezervnih delov ima v lasti. *Neprevidna* je oseba, ki ima v lasti največ en rezervni del. Ne pozabi na osebe, ki nimajo nobenega rezervnega dela. Uporabi funkcijo [`coalesce`](http://www.postgresql.org/docs/current/static/functions-conditional.html), ki morebitno vrednost `NULL` zamenja s podano konstanto (recimo 0).

4. Izpiši ime osebe, ki ima največ vozniških izkušenj. Predpostavljamo, da je vsak lastnik vozil vsakega od svojih traktorjev od dneva nakupa do danes povprečno 15 minut na dan. Količine vozniških izkušenj (števila ur) ni treba izpisovati.

5. Vaščani se odločijo rezervne dele zložiti v skupni fond, iz katerega bo potem vsak po potrebi jemal, ko se mu pokvari traktor. Za vsak tip rezervnega dela izpiši, koliko traktorjev lahko preskrbijo z delom tega tipa. (Štejemo samo prvo okvaro: če imamo en sam volan za Mercedese in 8 Mercedesov, pa nič drugih traktorjev, lahko z volanom preskrbimo 8 traktorjev, ne enega.)

   *Namig:* Uporabi `count` z določilom `DISTINCT`.

6. V obliki *dan. mesec.* (npr. *19. 7.*) izpiši vse datume, na katere imata rojstni dan vsaj dve osebi. Mesec iz datuma dobiš s funkcijo `extract(month FROM datumska_vrednost)`, podobno tudi za dan (glej [funkcije za časovne vrednosti](http://www.postgresql.org/docs/current/static/functions-datetime.html#FUNCTIONS-DATETIME-EXTRACT)). Spomni se tudi operatorja `||` za stikanje nizov (t.j., "seštevanje" nizov).
