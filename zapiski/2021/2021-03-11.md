---
tags: vaje, opb, view, select, gnezdenje
hackmd: https://hackmd.io/SPuCK8wsS8-4ksywJqIN2g
---
# Osnove podatkovnih baz - vaje 11.3.2021

---

## Pogledi (`VIEW`), gnezdene poizvedbe (sub`SELECT`s), zahtevnejši `SELECT` stavki

Še naprej delamo na tabelah s traktorji.

Če v nalogi ni čisto točno določeno, kaj je treba izpisati (npr. ime osebe ali ID osebe), v glavnem velja, da se izogni tovrstnim tehnikalijam, reši lažjo varianto in raje porabi čas za še druge naloge.

Naloge poleg določil `JOIN` in `GROUP BY` večinoma zahtevajo še uporabo kakšnega od naslednjih pristopov/ukazov/določil:

* [`CREATE VIEW`](http://www.postgresql.org/docs/current/static/sql-createview.html)
* gnezdene poizvedbe (subqueries)
* [`UNION [ALL]`, `INTERSECT [ALL]`, `EXCEPT [ALL]`](http://www.postgresql.org/docs/current/static/queries-union.html)
* [`EXISTS`, `ANY`, `ALL`](http://www.postgresql.org/docs/current/static/functions-subquery.html)
* [`WITH`](http://www.postgresql.org/docs/current/static/queries-with.html)

### Naloge

1. Vsak traktor je vreden 10000 dolarjev, vsak rezervni del pa 100.

    * Sestavi pogled `traktor_premozenje` s stolpcema `lastnik` in `vrednost`, ki za vsako osebo, ki ima v lasti kaksen traktor, pove, koliko so vredni njegovi traktorji.
    * Sestavi pogled `deli_premozenje(lastnik, vrednost)`, ki poda podobno informacijo za rezervne dele.
    * Z uporabo zgornjih dveh pogledov sestavi poizvedbo, ki za vsako osebo izpiše, koliko ima premoženja.
    * Sestavi isto poizvedbo še brez uporabe pogledov, z gnezdenimi `SELECT`i.

2. Izpiši ljudi, ki nimajo nobenega otroka z rdečim traktorjem.

3. Za vsako osebo izpiši, koliko ima takšnih rezervnih delov, ki jih ne more uporabiti na nobenem od svojih traktorjev. Oseb, za katere bi bila ta vrednost 0, ni treba izpisovati.

4. Izpiši ime osebe, ki ima v lasti največ različnih znamk traktorjev.

5. Izpiši osebe, katerih otroci so vsi lastniki traktorja iste znamke (t.j., obstaja znamka traktorja, ki jo imajo vsi otroci te osebe). Oseb brez otrok ne izpisuj.

6. Za vsako osebo izpiši, koliko rezervih delov ima na razpolago. "Imeti na razpolago" ni isto kot "imeti v lasti"; za potrebe te naloge veljajo naslednja pravila:

   * rezervni deli so na razpolago lastniku
   * staršu so na razpolago vsi rezervni deli, ki jih imajo v lasti njegovi otroci
   * če ima nek del na razpolago *N* ljudi, vsakemu priznavamo le 1/*N* razpoložljivosti. Če ima nekdo npr. v lasti 3 rezervne dele, v bazi pa nastopa tudi njegov oče (ki sam ni lastnik nobenega rezervnega dela), potem naj poizvedba tako za sina kot za očeta izpiše, da imata na razpolago 1.5 dela.

7. Izpiši vse osebe, ki imajo v lasti vsaj dva traktorja. Prepovedana je uporaba `GROUP BY` in funkcije `count`.
